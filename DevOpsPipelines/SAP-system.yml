# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

parameters:

- name: osprep
  displayName: OS Preparations
  type: boolean
  default: true

trigger:
  none

pool:
  name: $(agent)

# variables:

stages:
- stage: Publish_Pipeline_Artifact
  jobs:
  - job: Publish_Pipeline_Artifact
    steps:
    - task: PublishPipelineArtifact@1
      displayName: 'Publish Pipeline Artifact'
      inputs:
        targetPath: '$(System.DefaultWorkingDirectory)'
        artifact: hana

- stage: Base-OS-Config
  condition: eq(${{ osprep }}, true)
  jobs:
  - job: Base-OS-Config
    steps:
    - checkout: none
    - task: Ansible@0
      displayName: 'Base OS Config'
      inputs:
        ansibleInterface: 'agentMachine'
        playbookPathOnAgentMachine: 'playbook_01_os_base_config.yaml'
        inventoriesAgentMachine: inlineContent
        inventoryInlineContentAgentMachine: |
          [hana]
          $(privateip)
        args: -vv 


- task: Ansible@0
  displayName: Base OS Config
  inputs:
    ansibleInterface: 'agentMachine'
    playbookPathOnAgentMachine: 'file path playbook'
    inventoriesAgentMachine: 'file'
    inventoryFileOnAgentMachine: 'ansible.cfg'

